<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Отчёт о визите</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'DejaVu Sans', Arial, sans-serif;
      font-size: 11pt;
      line-height: 1.4;
      color: #333;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      border-bottom: 3px solid #007bff;
      padding-bottom: 15px;
      margin-bottom: 20px;
    }

    .header-left {
      flex: 1;
    }

    .header-right {
      text-align: right;
      flex: 1;
    }

    .logo {
      max-width: 120px;
      max-height: 60px;
      margin-bottom: 10px;
    }

    .workshop-name {
      font-size: 18pt;
      font-weight: bold;
      color: #007bff;
      margin-bottom: 5px;
    }

    .workshop-info {
      font-size: 9pt;
      color: #666;
    }

    .report-title {
      font-size: 16pt;
      font-weight: bold;
      color: #007bff;
      margin-bottom: 3px;
    }

    .report-info {
      font-size: 9pt;
      color: #666;
    }

    .section {
      margin-bottom: 20px;
      page-break-inside: avoid;
    }

    .section-title {
      background: #f0f7ff;
      padding: 8px 12px;
      font-weight: bold;
      font-size: 12pt;
      color: #007bff;
      border-left: 4px solid #007bff;
      margin-bottom: 10px;
    }

    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px 20px;
      margin-bottom: 10px;
    }

    .info-item {
      padding: 5px 0;
      border-bottom: 1px solid #eee;
    }

    .label {
      font-weight: bold;
      color: #666;
      font-size: 9pt;
    }

    .value {
      color: #333;
      margin-top: 2px;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    .checklist {
      list-style: none;
      padding: 0;
    }

    .checklist li {
      padding: 6px 0;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
    }

    .checklist li:last-child {
      border-bottom: none;
    }

    .photo-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }

    .photo-grid img {
      width: 100%;
      height: auto;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .materials-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    .materials-table th,
    .materials-table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
      font-size: 10pt;
    }

    .materials-table th {
      background: #f8f9fa;
      font-weight: bold;
      color: #007bff;
    }

    .materials-table td {
      background: white;
    }

    .total-row {
      font-weight: bold;
      background: #f0f7ff !important;
    }

    .text-right {
      text-align: right;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 9pt;
      font-weight: bold;
    }

    .status-IN_PROGRESS {
      background: #ffc107;
      color: #000;
    }

    .status-COMPLETED {
      background: #28a745;
      color: white;
    }

    .status-DELIVERED {
      background: #007bff;
      color: white;
    }

    .status-CANCELLED {
      background: #dc3545;
      color: white;
    }

    .footer {
      margin-top: 40px;
      padding-top: 15px;
      border-top: 2px solid #ddd;
      text-align: center;
      font-size: 9pt;
      color: #666;
    }

    .signature-box {
      text-align: center;
      margin: 20px 0;
    }

    .signature {
      max-width: 180px;
      max-height: 80px;
      margin-bottom: 10px;
    }

    .no-data {
      color: #999;
      font-style: italic;
    }

    @media print {
      body {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    }
  </style>
</head>
<body>
  <!-- Заголовок -->
  <div class="header">
    <div class="header-left">
      {{#if workshopLogo}}
      <img src="{{workshopLogo}}" alt="Логотип" class="logo">
      {{/if}}
      <div class="workshop-name">{{workshopName}}</div>
      <div class="workshop-info">
        {{#if workshopPhone}}{{workshopPhone}}<br>{{/if}}
        {{#if workshopAddress}}{{workshopAddress}}{{/if}}
      </div>
    </div>
    <div class="header-right">
      <div class="report-title">ОТЧЁТ О ВИЗИТЕ</div>
      <div class="report-info">
        Дата: {{reportDate}}<br>
        № {{visitId}}
      </div>
    </div>
  </div>

  <!-- Информация об автомобиле -->
  <div class="section">
    <div class="section-title">ИНФОРМАЦИЯ ОБ АВТОМОБИЛЕ</div>
    <div class="info-grid">
      <div class="info-item">
        <div class="label">Марка и модель:</div>
        <div class="value">{{carBrand}} {{carModel}}</div>
      </div>
      <div class="info-item">
        <div class="label">Госномер:</div>
        <div class="value"><strong>{{carLicensePlate}}</strong></div>
      </div>
      <div class="info-item">
        <div class="label">VIN:</div>
        <div class="value">{{carVin}}</div>
      </div>
      <div class="info-item">
        <div class="label">Год выпуска:</div>
        <div class="value">{{carYear}}</div>
      </div>
      <div class="info-item">
        <div class="label">Владелец:</div>
        <div class="value">{{ownerName}}</div>
      </div>
      <div class="info-item">
        <div class="label">Телефон:</div>
        <div class="value">{{ownerPhone}}</div>
      </div>
    </div>
  </div>

  <!-- Информация о визите -->
  <div class="section">
    <div class="section-title">ИНФОРМАЦИЯ О ВИЗИТЕ</div>
    <div class="info-grid">
      <div class="info-item">
        <div class="label">Дата приёмки:</div>
        <div class="value">{{visitDate}}</div>
      </div>
      <div class="info-item">
        <div class="label">Тип работ:</div>
        <div class="value">{{workType}}</div>
      </div>
      <div class="info-item">
        <div class="label">Статус:</div>
        <div class="value">
          <span class="status-badge status-{{status}}">{{statusText}}</span>
        </div>
      </div>
      <div class="info-item">
        <div class="label">Планируемая готовность:</div>
        <div class="value">{{estimatedCompletionDate}}</div>
      </div>
      <div class="info-item full-width">
        <div class="label">Описание работ:</div>
        <div class="value">{{workDescription}}</div>
      </div>
    </div>
  </div>

  <!-- Чек-лист приёмки -->
  <div class="section">
    <div class="section-title">ЧЕК-ЛИСТ ПРИЁМКИ</div>
    <ul class="checklist">
      <li>
        <span class="label">Уровень топлива:</span>
        <span class="value">{{fuelLevel}}{{#if fuelLevel}}%{{/if}}</span>
      </li>
      <li>
        <span class="label">Пробег:</span>
        <span class="value">{{mileage}}{{#if mileage}} км{{/if}}</span>
      </li>
      <li>
        <span class="label">Повреждения:</span>
        <span class="value">
          {{#if hasDamages}}
            Да — {{damagesDescription}}
          {{else}}
            Нет
          {{/if}}
        </span>
      </li>
      <li>
        <span class="label">Личные вещи в салоне:</span>
        <span class="value">{{personalItems}}</span>
      </li>
      <li>
        <span class="label">Состояние шин:</span>
        <span class="value">{{tireCondition}}</span>
      </li>
    </ul>
  </div>

  <!-- Фото ДО -->
  {{#if hasBeforePhotos}}
  <div class="section">
    <div class="section-title">ФОТО ДО РАБОТ</div>
    <div class="photo-grid">
      {{#each beforePhotos}}
      <img src="{{this}}" alt="Фото до">
      {{/each}}
    </div>
  </div>
  {{/if}}

  <!-- Фото ПОСЛЕ -->
  {{#if hasAfterPhotos}}
  <div class="section">
    <div class="section-title">ФОТО ПОСЛЕ РАБОТ</div>
    <div class="photo-grid">
      {{#each afterPhotos}}
      <img src="{{this}}" alt="Фото после">
      {{/each}}
    </div>
  </div>
  {{/if}}

  <!-- Материалы и запчасти -->
  {{#if hasMaterials}}
  <div class="section">
    <div class="section-title">ИСПОЛЬЗОВАННЫЕ МАТЕРИАЛЫ И ЗАПЧАСТИ</div>
    <table class="materials-table">
      <thead>
        <tr>
          <th style="width: 45%;">Наименование</th>
          <th style="width: 15%;" class="text-right">Кол-во</th>
          <th style="width: 20%;" class="text-right">Цена за ед., ₽</th>
          <th style="width: 20%;" class="text-right">Сумма, ₽</th>
        </tr>
      </thead>
      <tbody>
        {{#each materials}}
        <tr>
          <td>{{name}}</td>
          <td class="text-right">{{quantity}}</td>
          <td class="text-right">{{price}}</td>
          <td class="text-right">{{total}}</td>
        </tr>
        {{/each}}
        <tr class="total-row">
          <td colspan="3"><strong>Итого материалы:</strong></td>
          <td class="text-right"><strong>{{materialsTotal}}</strong></td>
        </tr>
      </tbody>
    </table>
  </div>
  {{/if}}

  <!-- Стоимость -->
  <div class="section">
    <div class="section-title">СТОИМОСТЬ</div>
    <div class="info-grid">
      <div class="info-item">
        <div class="label">Планируемая стоимость:</div>
        <div class="value">{{estimatedCost}} ₽</div>
      </div>
      <div class="info-item">
        <div class="label">Итоговая стоимость:</div>
        <div class="value"><strong style="font-size: 14pt; color: #007bff;">{{finalCost}} ₽</strong></div>
      </div>
    </div>
  </div>

  <!-- Подпись -->
  <div class="signature-box">
    {{#if signature}}
    <img src="{{signature}}" alt="Подпись" class="signature">
    {{/if}}
    <div>Мастер: ________________</div>
  </div>

  <!-- Футер -->
  <div class="footer">
    <p>Дата формирования отчёта: {{generatedAt}}</p>
    <p style="margin-top: 5px; font-size: 8pt;">Сгенерировано с помощью MechanicCompanion</p>
  </div>
</body>
</html>
