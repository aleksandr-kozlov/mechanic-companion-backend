# Техническое задание: Журнал для автомехаников/детейлеров

## 1. Общее описание
Мобильное приложение (только для iOS) для учёта работ по обслуживанию и детейлингу автомобилей с возможностью фото-фиксации, хранения документов и истории обслуживания.

## 2. Целевая аудитория
- Автомастерские (механики, электрики)
- Детейлинг-центры
- Частные мастера
- Шиномонтажи

## 3. Основной функционал

### 3.1 Авторизация
- Регистрация по email + пароль
- Вход по email + пароль
- Восстановление пароля
- Опционально: вход через Apple ID (требование App Store для социальных логинов)

### 3.2 Главный экран - список автомобилей
**Карточка автомобиля содержит:**
- Фото автомобиля (главное фото)
- Госномер (основной идентификатор)
- Марка и модель
- Имя владельца (опционально)
- Телефон владельца (опционально)
- Дата последнего обслуживания
- Количество визитов

**Функции:**
- Поиск по госномеру/марке/владельцу
- Сортировка (по дате, по алфавиту)
- Добавление нового автомобиля
- Свайп для удаления

### 3.3 Создание/редактирование автомобиля
**Поля:**
- Госномер* (обязательное, уникальное)
- Марка*
- Модель*
- Год выпуска
- VIN-номер
- Владелец (ФИО)
- Телефон владельца
- Email владельца
- Фото автомобиля (до 3 фото)
- Заметки

### 3.4 Карточка автомобиля (детальный просмотр)
**Вкладки:**

#### История обслуживания
- Список всех визитов (в обратном хронологическом порядке)
- Превью: дата, тип работ, стоимость, статус
- Клик по визиту → открытие детальной карточки визита

#### Документы
- Список прикреплённых документов (договоры, акты, гарантийные талоны)
- Добавление документа (PDF, фото, DOC)
- Просмотр документа
- Удаление документа

#### Информация об авто
- Все данные об автомобиле
- Редактирование

### 3.5 Создание визита (заказа)

**Экран приёмки автомобиля:**
- Дата и время приёмки (автозаполнение текущими)
- Тип работ* (выбор из списка + своё)
    - Детейлинг
    - ТО
    - Ремонт
    - Диагностика
    - Шиномонтаж
    - Другое (свой вариант)
- Описание работ (текстовое поле)
- Фото "ДО" (до 10 фото)
    - Камера с возможностью сразу сделать фото
    - Выбор из галереи
    - Миниатюры с возможностью удаления
- Чек-лист состояния авто при приёмке:
    - Уровень топлива (визуальный индикатор)
    - Пробег
    - Царапины/повреждения (да/нет + фото)
    - Личные вещи в салоне (да/нет + описание)
    - Состояние дисков/шин (текст)
- Планируемая стоимость
- Планируемая дата готовности
- Статус (по умолчанию "В работе")

**Статусы визита:**
- В работе
- Готово
- Выдано
- Отменено

### 3.6 Детальная карточка визита

**Информация:**
- Все данные из создания
- Фото "ДО"
- Фото "ПОСЛЕ" (добавляются позже)
- Чек-лист выполненных работ (добавляется в процессе)
- Использованные материалы/запчасти (название, количество, цена)
- Итоговая стоимость
- Документы визита (акты, договоры)

**Действия:**
- Редактировать визит
- Добавить фото "ПОСЛЕ"
- Добавить материалы
- Добавить документ
- Изменить статус
- Экспорт отчёта (PDF)
- Отправить отчёт клиенту (email/мессенджер)

### 3.7 Экспорт отчёта (PDF)

**Содержание PDF:**
- Название мастерской (из настроек профиля)
- Дата визита
- Данные автомобиля
- Данные владельца
- Чек-лист приёмки
- Фото "ДО" и "ПОСЛЕ" (grid)
- Список выполненных работ
- Использованные материалы
- Стоимость
- Подпись мастера (опционально, из настроек)

### 3.8 Профиль пользователя

**Настройки:**
- Название мастерской/имя мастера
- Телефон
- Email
- Адрес
- Логотип (фото)
- Подпись (изображение или текст)
- Изменить пароль
- Выход

**Статистика (опционально для MVP):**
- Количество обслуженных авто за месяц
- Выручка за месяц
- Количество активных заказов

### 3.9 Уведомления (push - опционально для MVP)
- Напоминание о планируемой дате готовности заказа
- Можно отложить на v2

## 4. Технические требования

### 4.1 Стек
**Frontend:**
- React Native
- TypeScript
- React Navigation 
- React Hook Form
- React Native Paper
- React Query

**Работа с медиа:**
- react-native-image-picker (фото из галереи)
- react-native-camera или expo-camera (камера)
- react-native-document-picker (документы)
- react-native-pdf или react-native-view-pdf (просмотр PDF)
- react-native-image-resizer (оптимизация фото)

**Backend:**
- Node.js + Express / NestJS
- PostgreSQL (основная БД)
- AWS S3 / Cloudflare R2 (хранение фото/документов)
- JWT (авторизация)

**Генерация PDF:**
- Backend: puppeteer или PDFKit
- Или Frontend: react-native-html-to-pdf

### 4.2 API Endpoints

```
POST   /api/auth/register
POST   /api/auth/login
POST   /api/auth/forgot-password
POST   /api/auth/reset-password
GET    /api/auth/me

GET    /api/cars
POST   /api/cars
GET    /api/cars/:id
PUT    /api/cars/:id
DELETE /api/cars/:id
POST   /api/cars/:id/photos

GET    /api/cars/:carId/visits
POST   /api/cars/:carId/visits
GET    /api/visits/:id
PUT    /api/visits/:id
DELETE /api/visits/:id
POST   /api/visits/:id/photos
POST   /api/visits/:id/documents
DELETE /api/visits/:id/documents/:docId
GET    /api/visits/:id/export-pdf

GET    /api/profile
PUT    /api/profile
PUT    /api/profile/password

POST   /api/upload (общий endpoint для загрузки файлов)
```

### 4.3 Структура БД (основные таблицы)

**users**
- id (uuid)
- email (unique)
- password_hash
- workshop_name
- phone
- address
- logo_url
- signature_url
- created_at
- updated_at

**cars**
- id (uuid)
- user_id (foreign key)
- license_plate (indexed)
- brand
- model
- year
- vin
- owner_name
- owner_phone
- owner_email
- main_photo_url
- notes
- created_at
- updated_at

**car_photos**
- id (uuid)
- car_id (foreign key)
- photo_url
- created_at

**visits**
- id (uuid)
- car_id (foreign key)
- visit_date
- work_type
- work_description
- estimated_cost
- final_cost
- estimated_completion_date
- status (enum: in_progress, completed, delivered, cancelled)
- fuel_level
- mileage
- has_damages
- damages_description
- personal_items
- tire_condition
- created_at
- updated_at

**visit_photos**
- id (uuid)
- visit_id (foreign key)
- photo_url
- photo_type (enum: before, after)
- created_at

**visit_materials**
- id (uuid)
- visit_id (foreign key)
- name
- quantity
- price
- created_at

**visit_documents**
- id (uuid)
- visit_id (foreign key)
- document_url
- document_name
- document_type (pdf, image, doc)
- created_at

**car_documents**
- id (uuid)
- car_id (foreign key)
- document_url
- document_name
- document_type
- created_at

### 4.4 Безопасность
- HTTPS для всех запросов
- JWT с refresh token
- Rate limiting на API
- Валидация файлов (размер, тип)
- Сжатие изображений перед загрузкой
- Ограничение размера загружаемых файлов (фото до 10MB, документы до 20MB)

### 4.5 Оффлайн-режим (опционально для v2)
- Базовый просмотр данных без интернета
- Синхронизация при восстановлении соединения

## 5. UI/UX требования

### 5.1 Дизайн
- Минималистичный, профессиональный стиль
- Основные цвета: синий/серый (ассоциация с автосервисом)
- Крупные кнопки для удобства использования в мастерской
- Понятная иконография
- Dark mode (опционально)

### 5.2 Навигация
- Bottom Tab Navigation:
    - Автомобили (главный экран)
    - Добавить визит (быстрый доступ)
    - Профиль
- Stack Navigation внутри вкладок

### 5.3 Onboarding
- Простой туториал при первом запуске (3-4 экрана)
- Объяснение основных функций

## 6. План разработки (4 недели)

**Неделя 1:**
- Настройка проекта (RN, навигация, UI kit)
- Backend: настройка сервера, БД, auth endpoints
- Экраны авторизации (регистрация, вход, восстановление)

**Неделя 2:**
- CRUD автомобилей (список, добавление, редактирование)
- Загрузка фото автомобилей
- Backend: endpoints для автомобилей, интеграция S3

**Неделя 3:**
- CRUD визитов (создание, просмотр, редактирование)
- Фото "до/после"
- Чек-лист приёмки
- Добавление материалов
- Backend: endpoints для визитов

**Неделя 4:**
- Загрузка документов
- Генерация PDF отчётов
- Профиль пользователя
- Тестирование
- Подготовка к релизу в App Store
- Исправление багов

## 7. Требования App Store

- Privacy Policy (обязательно)
- Terms of Service
- Описание приложения на русском/английском
- Скриншоты (минимум 3)
- App Icon 1024x1024
- Соблюдение Human Interface Guidelines
- Обработка разрешений (камера, галерея, файлы)

## 8. Метрики успеха (для MVP)

- Возможность создать визит от начала до конца за < 2 минут
- Стабильная работа без крашей
- Успешная загрузка фото (99% успешных загрузок)
- Генерация PDF за < 5 секунд

---
