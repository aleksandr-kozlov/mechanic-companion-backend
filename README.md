# MechanicCompanion Backend

<div align="center">

**REST API –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–æ–º**

Backend –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è MechanicCompanion - –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–æ–º –¥–ª—è –∞–≤—Ç–æ–º–µ—Ö–∞–Ω–∏–∫–æ–≤, –¥–µ—Ç–µ–π–ª–µ—Ä–æ–≤ –∏ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–æ–≤.

[![NestJS](https://img.shields.io/badge/NestJS-11.1.13-E0234E?logo=nestjs)](https://nestjs.com/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.9.3-3178C6?logo=typescript)](https://www.typescriptlang.org/)
[![Prisma](https://img.shields.io/badge/Prisma-6.19.2-2D3748?logo=prisma)](https://www.prisma.io/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16-336791?logo=postgresql)](https://www.postgresql.org/)

</div>

---

## üìä –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

**–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–∑—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã! –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É.**

- ‚úÖ **–§–∞–∑–∞ 1:** –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –±–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- ‚úÖ **–§–∞–∑–∞ 2:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (JWT + Refresh Tokens)
- ‚úÖ **–§–∞–∑–∞ 3:** –ú–æ–¥—É–ª—å –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π (Cars)
- ‚úÖ **–§–∞–∑–∞ 4:** –ú–æ–¥—É–ª—å –≤–∏–∑–∏—Ç–æ–≤ (Visits)
- ‚úÖ **–§–∞–∑–∞ 5:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏
- ‚úÖ **–§–∞–∑–∞ 6:** Email —Å–µ—Ä–≤–∏—Å (Nodemailer)
- ‚úÖ **–§–∞–∑–∞ 7:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –æ—Ç—á—ë—Ç–æ–≤ (Puppeteer)
- ‚úÖ **–§–∞–∑–∞ 8:** –ú–æ–¥—É–ª—å –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **–§–∞–∑–∞ 9:** Security + Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –¥–µ–ø–ª–æ—é

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Node.js** 20+ (LTS —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **PostgreSQL** 16+
- **Docker** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **npm** –∏–ª–∏ **yarn**

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –° Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd MechanicCompanionBackend

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env (—Å–º. —Å–µ–∫—Ü–∏—é "–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è")

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL —á–µ—Ä–µ–∑ Docker
docker-compose up -d postgres

# 5. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
npx prisma migrate dev --name init

# 6. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –û—Ç–∫—Ä–æ–π—Ç–µ Prisma Studio –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ë–î
npx prisma studio

# 7. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run start:dev
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ:
- **API:** http://localhost:3000/api
- **Swagger Docs:** http://localhost:3000/api/docs
- **Health Check:** http://localhost:3000/api/health

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω—ã–π PostgreSQL

```bash
# 1-2. –¢–µ –∂–µ —à–∞–≥–∏ (–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ + —É—Å—Ç–∞–Ω–æ–≤–∫–∞)

# 3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ
# –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤—Ä—É—á–Ω—É—é –∏–ª–∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É:
createdb mechanic_companion

# 4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ DATABASE_URL –≤ .env
DATABASE_URL="postgresql://user:password@localhost:5432/mechanic_companion"

# 5-7. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –∫–∞–∫ –≤ –≤–∞—Ä–∏–∞–Ω—Ç–µ 1
```

---

## üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### Swagger UI

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:

**http://localhost:3000/api/docs**

Swagger –≤–∫–ª—é—á–∞–µ—Ç:
- üìù –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö 40 endpoints
- üîê –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ JWT
- ‚úÖ –°—Ö–µ–º—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- üß™ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API –ø—Ä—è–º–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –≥—Ä—É–ø–ø—ã endpoints

| –ì—Ä—É–ø–ø–∞ | Endpoints | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----------|----------|
| **Auth** | 6 | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –≤—Ö–æ–¥, refresh token, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è |
| **Profile** | 5 | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º, —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è, –∑–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ –∏ –ø–æ–¥–ø–∏—Å–∏ |
| **Cars** | 11 | CRUD –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π, —Ñ–æ—Ç–æ, –¥–æ–∫—É–º–µ–Ω—Ç—ã, –ø–æ–∏—Å–∫ |
| **Visits** | 14 | CRUD –≤–∏–∑–∏—Ç–æ–≤, —Å—Ç–∞—Ç—É—Å—ã, —Ñ–æ—Ç–æ, –¥–æ–∫—É–º–µ–Ω—Ç—ã, PDF —ç–∫—Å–ø–æ—Ä—Ç |
| **Materials** | 4 | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ –∏ –∑–∞–ø—á–∞—Å—Ç—è–º–∏ –¥–ª—è –≤–∏–∑–∏—Ç–æ–≤ |

**–í—Å–µ–≥–æ: 40 API endpoints**

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
MechanicCompanionBackend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ auth/                   # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/                # Data Transfer Objects
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guards/             # JWT Guards
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ strategies/         # Passport —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ decorators/         # @CurrentUser –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.module.ts
‚îÇ   ‚îú‚îÄ‚îÄ profile/                # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ profile.module.ts
‚îÇ   ‚îú‚îÄ‚îÄ cars/                   # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cars.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cars.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cars.module.ts
‚îÇ   ‚îú‚îÄ‚îÄ visits/                 # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–∑–∏—Ç–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ visits.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ visits.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ visits.module.ts
‚îÇ   ‚îú‚îÄ‚îÄ materials/              # –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –∑–∞–ø—á–∞—Å—Ç–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ materials.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ materials.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ materials.module.ts
‚îÇ   ‚îú‚îÄ‚îÄ mail/                   # Email —Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ templates/          # Handlebars —à–∞–±–ª–æ–Ω—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mail.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mail.module.ts
‚îÇ   ‚îú‚îÄ‚îÄ pdf/                    # PDF –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ templates/          # HTML —à–∞–±–ª–æ–Ω—ã –¥–ª—è PDF
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pdf.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pdf.module.ts
‚îÇ   ‚îú‚îÄ‚îÄ prisma/                 # Prisma ORM
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prisma.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prisma.module.ts
‚îÇ   ‚îú‚îÄ‚îÄ common/                 # –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filters/            # Exception —Ñ–∏–ª—å—Ç—Ä—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ interceptors/       # Response interceptors
‚îÇ   ‚îú‚îÄ‚îÄ config/                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ configuration.ts
‚îÇ   ‚îú‚îÄ‚îÄ main.ts                 # Entry point (Security + Swagger)
‚îÇ   ‚îî‚îÄ‚îÄ app.module.ts           # –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma           # –°—Ö–µ–º–∞ –ë–î (11 –º–æ–¥–µ–ª–µ–π)
‚îú‚îÄ‚îÄ uploads/                    # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ .env.example                # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ docker-compose.yml          # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile                  # Multi-stage build
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ BACKEND_PLAN.md             # –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ CLAUDE.md                   # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è Claude Code
‚îî‚îÄ‚îÄ README.md                   # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä security –º–µ—Ä:

- ‚úÖ **Helmet** - –∑–∞—â–∏—Ç–∞ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- ‚úÖ **CORS** - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ CORS
- ‚úÖ **Rate Limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç DDoS (100 req/min, auth: 5 req/min)
- ‚úÖ **JWT Authentication** - Access (1h) + Refresh (7d) —Ç–æ–∫–µ–Ω—ã
- ‚úÖ **Password Hashing** - bcrypt —Å 10 rounds
- ‚úÖ **Input Validation** - class-validator –¥–ª—è –≤—Å–µ—Ö DTO
- ‚úÖ **SQL Injection Protection** - Prisma ORM
- ‚úÖ **File Upload Validation** - —Ä–∞–∑–º–µ—Ä, —Ç–∏–ø, –æ–±—Ä–∞–±–æ—Ç–∫–∞

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞ Prisma

**11 –º–æ–¥–µ–ª–µ–π** –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤ 3 –≥—Ä—É–ø–ø—ã:

#### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `User` - –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- `RefreshToken` - JWT refresh —Ç–æ–∫–µ–Ω—ã
- `PasswordResetToken` - —Ç–æ–∫–µ–Ω—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è

#### 2. –ê–≤—Ç–æ–º–æ–±–∏–ª–∏
- `Car` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≤—Ç–æ–º–æ–±–∏–ª—è—Ö
- `CarPhoto` - —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π (–¥–æ 3 —à—Ç)
- `CarDocument` - –¥–æ–∫—É–º–µ–Ω—Ç—ã (PDF, DOC, DOCX)

#### 3. –í–∏–∑–∏—Ç—ã
- `Visit` - –≤–∏–∑–∏—Ç—ã –≤ –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å
- `VisitPhoto` - —Ñ–æ—Ç–æ –î–û/–ü–û–°–õ–ï (PhotoType enum)
- `VisitMaterial` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
- `VisitDocument` - –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤–∏–∑–∏—Ç–∞

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Cascade —É–¥–∞–ª–µ–Ω–∏–µ (User ‚Üí Cars ‚Üí Visits)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–æ–≤ (`visitsCount`, `lastVisitDate`)
- –°–æ—Å—Ç–∞–≤–Ω—ã–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- Decimal –ø–æ–ª—è –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞ –¥–µ–Ω–µ–≥

### –ö–æ–º–∞–Ω–¥—ã Prisma

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
npx prisma migrate dev

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
npx prisma migrate deploy

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Prisma Client
npx prisma generate

# –û—Ç–∫—Ä—ã—Ç—å Prisma Studio (GUI –¥–ª—è –ë–î)
npx prisma studio

# –°–±—Ä–æ—Å–∏—Ç—å –ë–î (‚ö†Ô∏è —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ)
npx prisma migrate reset
```

---

## üìß Email –∏ PDF

### Email —Å–µ—Ä–≤–∏—Å

- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** Nodemailer + @nestjs-modules/mailer
- **–®–∞–±–ª–æ–Ω—ã:** Handlebars (`.hbs`)
- **–¢–∏–ø—ã –ø–∏—Å–µ–º:**
  - Password Reset - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
  - Visit Report - –æ—Ç—á—ë—Ç –æ –≤–∏–∑–∏—Ç–µ —Å PDF

### PDF –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** Puppeteer
- **–§–æ—Ä–º–∞—Ç:** A4, 20mm margins
- **–®–∞–±–ª–æ–Ω—ã:** HTML + CSS (Handlebars)
- **–í–∫–ª—é—á–∞–µ—Ç:**
  - –õ–æ–≥–æ—Ç–∏–ø –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π
  - –î–µ—Ç–∞–ª–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è –∏ –≤–∏–∑–∏—Ç–∞
  - –§–æ—Ç–æ –î–û/–ü–û–°–õ–ï
  - –¢–∞–±–ª–∏—Ü–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —Å –∏—Ç–æ–≥–∞–º–∏
  - –ü–æ–¥–ø–∏—Å—å –º–∞—Å—Ç–µ—Ä–∞

**Endpoints:**
- `GET /api/visits/:id/export-pdf` - —Å–∫–∞—á–∞—Ç—å PDF
- `POST /api/visits/:id/send-report` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ email

---

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run start:dev          # –ó–∞–ø—É—Å–∫ —Å hot-reload
npm run start:debug        # –ó–∞–ø—É—Å–∫ —Å debugger

# –°–±–æ—Ä–∫–∞ –∏ –ø—Ä–æ–¥–∞–∫—à–Ω
npm run build              # –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
npm run start:prod         # –ó–∞–ø—É—Å–∫ production build

# –õ–∏–Ω—Ç–∏–Ω–≥ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
npm run lint               # ESLint –ø—Ä–æ–≤–µ—Ä–∫–∞
npm run format             # Prettier —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
npx prisma studio          # GUI –¥–ª—è –ë–î
npx prisma migrate dev     # –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
npx prisma generate        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma Client

# Docker
docker-compose up -d postgres     # –¢–æ–ª—å–∫–æ PostgreSQL
docker-compose up --build         # –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
docker-compose down               # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ
docker-compose logs -f app        # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```

---

## üåç –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:

```env
# –°–µ—Ä–≤–µ—Ä
NODE_ENV=development
PORT=3000
API_PREFIX=api

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL="postgresql://user:password@localhost:5432/mechanic_companion"

# JWT
JWT_SECRET=your-super-secret-jwt-key-min-32-characters
JWT_REFRESH_SECRET=your-refresh-secret-different-from-jwt-secret
JWT_EXPIRES_IN=1h
JWT_REFRESH_EXPIRES_IN=7d

# Email (SMTP)
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USER=your-email@gmail.com
MAIL_PASSWORD=your-app-password
MAIL_FROM="MechanicCompanion <noreply@example.com>"

# Frontend URL (–¥–ª—è —Å—Å—ã–ª–æ–∫ –≤ email)
FRONTEND_URL=http://localhost:3000

# CORS
CORS_ORIGIN=*

# Rate Limiting
THROTTLE_TTL=60
THROTTLE_LIMIT=100

# Puppeteer (–¥–ª—è Docker)
PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=false
PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium-browser
```

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` –≤ Git!

---

## üê≥ Docker

### –ó–∞–ø—É—Å–∫ —Å Docker Compose

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ PostgreSQL
docker-compose up -d postgres

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–µ—Å—å —Å—Ç–µ–∫ (PostgreSQL + App)
docker-compose up --build

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs -f app
```

### Multi-stage Dockerfile

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π multi-stage build:
- **Stage 1 (builder):** –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma Client, —Å–±–æ—Ä–∫–∞ TypeScript
- **Stage 2 (production):** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ —Å Chromium –¥–ª—è Puppeteer

---

## üìù API –ü—Ä–∏–º–µ—Ä—ã

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

```bash
POST /api/auth/register
Content-Type: application/json

{
  "email": "mechanic@example.com",
  "password": "SecurePass123",
  "workshopName": "–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å –ë—ã—Å—Ç—Ä—ã–π –†–µ–º–æ–Ω—Ç"
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è

```bash
POST /api/cars
Authorization: Bearer <access_token>
Content-Type: application/json

{
  "licensePlate": "–ê123–ë–í777",
  "brand": "Toyota",
  "model": "Camry",
  "year": 2020,
  "ownerName": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
  "ownerPhone": "+79991234567"
}
```

### –≠–∫—Å–ø–æ—Ä—Ç PDF –æ—Ç—á—ë—Ç–∞

```bash
GET /api/visits/:id/export-pdf
Authorization: Bearer <access_token>
```

–ë–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ **Swagger UI**: http://localhost:3000/api/docs

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   ```bash
   npm run start:dev
   ```

2. **–û—Ç–∫—Ä–æ–π—Ç–µ Swagger UI:**
   ```
   http://localhost:3000/api/docs
   ```

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ flow:**
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí Login ‚Üí –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω
   - –°–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å ‚Üí –°–æ–∑–¥–∞—Ç—å –≤–∏–∑–∏—Ç
   - –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã ‚Üí –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å PDF

### Postman Collection

–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ Swagger JSON –≤ Postman:
```
http://localhost:3000/api/docs-json
```

---

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ

- **@nestjs/core** - NestJS framework
- **@prisma/client** - Prisma ORM
- **bcrypt** - Password hashing
- **jsonwebtoken** - JWT tokens
- **@nestjs/jwt** & **@nestjs/passport** - Authentication
- **@nestjs-modules/mailer** - Email sending
- **puppeteer** - PDF generation
- **sharp** - Image processing
- **helmet** - Security headers
- **compression** - Response compression
- **@nestjs/swagger** - API documentation

### Dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- **typescript** - TypeScript compiler
- **@nestjs/cli** - NestJS CLI
- **prisma** - Prisma CLI
- **eslint** & **prettier** - Code quality

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤ `package.json`

---

## üö¢ –î–µ–ø–ª–æ–π

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

1. **–û–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```env
   NODE_ENV=production
   DATABASE_URL=<production-db-url>
   JWT_SECRET=<strong-random-secret>
   CORS_ORIGIN=https://yourdomain.com
   ```

2. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
   ```bash
   npx prisma migrate deploy
   ```

3. **–°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç:**
   ```bash
   npm run build
   ```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ:**
   ```bash
   npm run start:prod
   ```

### Docker –¥–µ–ø–ª–æ–π

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t mechanic-companion-backend .

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -p 3000:3000 --env-file .env mechanic-companion-backend
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **PM2** –∏–ª–∏ **systemd** –¥–ª—è process management
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ **Nginx** –∫–∞–∫ reverse proxy
- –í–∫–ª—é—á–∏—Ç–µ **SSL/TLS** (Let's Encrypt)
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ **–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** (Winston, Pino)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** (Sentry, DataDog)

---

## ü§ù –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

**React Native –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:** `/Users/akozlov/projects/MechanicCompanion`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

–í React Native –ø—Ä–æ–µ–∫—Ç–µ –æ–±–Ω–æ–≤–∏—Ç–µ `src/config.ts`:

```typescript
export const API_BASE_URL = 'http://localhost:3000/api';
export const USE_MOCKS = false; // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ false –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
```

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤ API

–í—Å–µ –æ—Ç–≤–µ—Ç—ã —Å–ª–µ–¥—É—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É:

```typescript
{
  "data": T,              // –î–∞–Ω–Ω—ã–µ (–æ–±—ä–µ–∫—Ç –∏–ª–∏ –º–∞—Å—Å–∏–≤)
  "message"?: string,     // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  "success": boolean      // –°—Ç–∞—Ç—É—Å –æ–ø–µ—Ä–∞—Ü–∏–∏
}
```

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è MechanicCompanion.

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** `BACKEND_PLAN.md`
- **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è Claude Code:** `CLAUDE.md`
- **Swagger API:** http://localhost:3000/api/docs
- **Prisma Studio:** `npx prisma studio`

---

<div align="center">

**–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –∏—Å–ø–æ–ª—å–∑—É—è NestJS, Prisma –∏ TypeScript**

**–í–µ—Ä—Å–∏—è:** 1.0.0 | **–°—Ç–∞—Ç—É—Å:** Production Ready ‚úÖ

</div>
